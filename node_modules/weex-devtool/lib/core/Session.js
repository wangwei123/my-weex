'use strict';

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Channel = require('./Channel');
var Uuid = require('uuid');

var Session = function () {
    function Session() {
        (0, _classCallCheck3.default)(this, Session);

        this.channel = new Channel();
        this.id = Uuid();
        this.size = 0;
    }

    (0, _createClass3.default)(Session, [{
        key: 'join',
        value: function join(target) {
            var _this = this;

            if (!this[target.role]) {
                if (this.size >= 2) {
                    return;
                }
                this.size++;
            } else {
                this[target.role].destroy();
            }
            this[target.role] = target;
            this.channel.join(target.socket, target.role);
            target.on('message', function (message) {
                return _this.channel.send(message, target.socket);
            });
            target.on('destory', function () {
                _this.channel.leave(target.socket);
                delete _this[target.role];
                target = null;
                _this.size--;
                if (_this.size == 0) {
                    _this.destory();
                }
            });
        }
    }, {
        key: 'destroy',
        value: function destroy() {}
    }]);
    return Session;
}();