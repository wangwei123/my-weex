{"version":3,"sources":["../../src/register-decorator.ts"],"names":[],"mappings":";AACA,gCAA8B,4BAA4B,CAAC,CAAA;AAC3D,mCAAiC,+BAA+B,CAAC,CAAA;AAEjE,mCAAiC,+BAA+B,CAAC,CAAA;AAEjE,gCAA8B,8BAA8B,CAAC,CAAA;AAE7D,0BAA+B,aAAa,CAAC,CAAA;AAwC7C;;GAEG;AACH,2BAAkC,OAAmC;IAEjE,IAAI,aAAuB,CAAC;IAC5B,EAAE,CAAC,CAAC,OAAO,CAAC,SAAS,YAAY,QAAQ,CAAC,CAAC,CAAC;QACxC,aAAa,GAAG,OAAO,CAAC,SAAqB,CAAC;IAClD,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,IAAM,WAAS,GAAG,OAAO,CAAC,SAAyC,CAAC;QACpE,aAAa,GAAG;YAAA;YAYhB,CAAC;YAXG,mCAAQ,GAAR,UAAS,KAAU,EAAE,mBAAyC;gBAC1D,MAAM,CAAC,WAAS,CAAC,QAAQ,CAAC,KAAK,EAAE,mBAAmB,CAAC,CAAC;YAC1D,CAAC;YAED,yCAAc,GAAd,UAAe,mBAAyC;gBACpD,EAAE,CAAC,CAAC,WAAS,CAAC,cAAc,CAAC,CAAC,CAAC;oBAC3B,MAAM,CAAC,WAAS,CAAC,cAAc,CAAC,mBAAmB,CAAC,CAAC;gBACzD,CAAC;gBAED,MAAM,CAAC,EAAE,CAAC;YACd,CAAC;YACL,uBAAC;QAAD,CAZgB,AAYf,GAAA,CAAC;QACF,4BAAgB,CAAC,iCAAe,CAAC,CAAC,qBAAqB,CAAC,IAAI,uCAAkB,CAAC,aAAa,EAAE,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;IAChI,CAAC;IAED,IAAM,sBAAsB,GAA2B;QACnD,IAAI,EAAE,iCAAe,CAAC,iBAAiB;QACvC,MAAM,EAAE,OAAO,CAAC,MAAM;QACtB,YAAY,EAAE,OAAO,CAAC,YAAY;QAClC,iBAAiB,EAAE,OAAO,CAAC,OAAO;QAClC,aAAa,EAAE,aAAa;QAC5B,WAAW,EAAE,OAAO,CAAC,WAAW;KACnC,CAAC;IACF,4BAAgB,CAAC,iCAAe,CAAC,CAAC,qBAAqB,CAAC,IAAI,uCAAkB,CAAC,sBAAsB,CAAC,CAAC,CAAC;AAC5G,CAAC;AAhCe,yBAAiB,oBAgChC,CAAA","file":"register-decorator.js","sourcesContent":["import {ValidatorOptions} from \"./validation/ValidatorOptions\";\nimport {MetadataStorage} from \"./metadata/MetadataStorage\";\nimport {ConstraintMetadata} from \"./metadata/ConstraintMetadata\";\nimport {ValidatorConstraintInterface} from \"./validation/ValidatorConstraintInterface\";\nimport {ValidationMetadata} from \"./metadata/ValidationMetadata\";\nimport {ValidationMetadataArgs} from \"./metadata/ValidationMetadataArgs\";\nimport {ValidationTypes} from \"./validation/ValidationTypes\";\nimport {ValidationArguments} from \"./validation/ValidationArguments\";\nimport {getFromContainer} from \"./container\";\n\nexport interface ValidationDecoratorOptions {\n\n    /**\n     * Target object to be validated.\n     */\n    target: Function;\n\n    /**\n     * Target object's property name to be validated.\n     */\n    propertyName: string;\n\n    /**\n     * Name of the validation that is being registered.\n     */\n    name?: string;\n\n    /**\n     * Indicates if this decorator will perform async validation.\n     */\n    async?: boolean;\n\n    /**\n     * Validator options.\n     */\n    options: ValidatorOptions;\n\n    /**\n     * Array of validation constraints.\n     */\n    constraints?: any[];\n\n    /**\n     * Validator that performs validation.\n     */\n    validator: ValidatorConstraintInterface|Function;\n}\n\n/**\n * Registers a custom validation decorator.\n */\nexport function registerDecorator(options: ValidationDecoratorOptions): void {\n\n    let constraintCls: Function;\n    if (options.validator instanceof Function) {\n        constraintCls = options.validator as Function;\n    } else {\n        const validator = options.validator as ValidatorConstraintInterface;\n        constraintCls = class CustomConstraint implements ValidatorConstraintInterface {\n            validate(value: any, validationArguments?: ValidationArguments): Promise<boolean>|boolean {\n                return validator.validate(value, validationArguments);\n            }\n\n            defaultMessage(validationArguments?: ValidationArguments) {\n                if (validator.defaultMessage) {\n                    return validator.defaultMessage(validationArguments);\n                }\n\n                return \"\";\n            }\n        };\n        getFromContainer(MetadataStorage).addConstraintMetadata(new ConstraintMetadata(constraintCls, options.name, options.async));\n    }\n\n    const validationMetadataArgs: ValidationMetadataArgs = {\n        type: ValidationTypes.CUSTOM_VALIDATION,\n        target: options.target,\n        propertyName: options.propertyName,\n        validationOptions: options.options,\n        constraintCls: constraintCls,\n        constraints: options.constraints\n    };\n    getFromContainer(MetadataStorage).addValidationMetadata(new ValidationMetadata(validationMetadataArgs));\n}"],"sourceRoot":"."}